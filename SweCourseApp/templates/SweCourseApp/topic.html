{% extends 'base.html' %}
{% load static %}
{% load widget_tweaks %}

{% block content %}
<link href={% static "css/index.css" %} rel="stylesheet">

<div class="container">
    <div class="row ">
        <h2 class="text-primary">{{topic.title}}</h2>
    </div>
    <div class="row">
        {% autoescape off %}
        {{topic.content}} 
        {% endautoescape %}
    </div>
    
    <div class="row justify-content-center mb-4">
        <div class="col-md-12 col-lg-11 col-xl-10">
            <button class="w-100 btn btn-lg btn-primary" type="submit"  id="addResourceButton">Add Resource</button>
        </div>
    </div>
    <div class="row justify-content-center mb-4" id="addResource">
        <div class="col-md-12 col-lg-11 col-xl-10">
        <form method="post" id="resource-form" >
		{% csrf_token %}
		{{resource_form.media}}
		<div >
				<div class="mb-4 h-350px">
					<label for="form-label"> {{ resource_form.content.label_tag }}</label>
					{% render_field resource_form.content class="form-control" id="rich" %}
				</div>
				<button class="w-100 btn btn-lg btn-primary" id="resoruce-submit" data-id="{{topic.id}}" type="submit">Submit</button>
		</div>
		</form>
    </div>

    </div>
    <div class="row d-flex justify-content-center">
        <div class="col-md-12 col-lg-11 col-xl-10">
          <div class="card">
            <div class="card-body">
              <div class="d-flex flex-start align-items-center">
                <img class="rounded-circle shadow-1-strong me-3"
                  src="https://mdbcdn.b-cdn.net/img/Photos/Avatars/img%20(19).webp" alt="avatar" width="60"
                  height="60" />
                <div>
                  <h6 class="fw-bold text-primary mb-1">Lily Coleman</h6>
                  <p class="text-muted small mb-0">
                    Shared publicly - Jan 2020
                  </p>
                </div>
              </div>
  
              <p class="mt-3 mb-4 pb-2">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod
                tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
                quis nostrud exercitation ullamco laboris nisi ut aliquip consequat.
              </p>
  
              <div class="small d-flex justify-content-start">
                <a href="#!" class="d-flex align-items-center me-3">
                  <i class="far fa-thumbs-up me-2"></i>
                  <p class="mb-0">Like</p>
                </a>
                <a href="#!" class="d-flex align-items-center me-3">
                  <i class="far fa-comment-dots me-2"></i>
                  <p class="mb-0">Comment</p>
                </a>
                <a href="#!" class="d-flex align-items-center me-3">
                  <i class="fas fa-share me-2"></i>
                  <p class="mb-0">Share</p>
                </a>
              </div>
            </div>
            <div class="card-footer py-3 border-0" style="background-color: #f8f9fa;">
              <div class="d-flex flex-start w-100">
                <img class="rounded-circle shadow-1-strong me-3"
                  src="https://mdbcdn.b-cdn.net/img/Photos/Avatars/img%20(19).webp" alt="avatar" width="40"
                  height="40" />
                <div class="form-outline w-100">
                  <textarea class="form-control" id="textAreaExample" rows="4"
                    style="background: #fff;"></textarea>
                  <label class="form-label" for="textAreaExample">Message</label>
                </div>
              </div>
              <div class="float-end mt-2 pt-1">
                <button type="button" class="btn btn-primary btn-sm">Post comment</button>
                <button type="button" class="btn btn-outline-primary btn-sm">Cancel</button>
              </div>
            </div>
          </div>
        </div>
      </div>
</div>
<script src={% static "js/jquery.min.js" %} ></script>
<script src={% static "js/topic.js" %} ></script>

{% block javascript %}
<script>
    $("#resource-form").submit(function (e) {
	// preventing from page reload and default actions
	e.preventDefault();
	// serialize the data for sending the form data.
	var serializedData = $(this).serialize();
  var id = $('#resoruce-submit').data("id");
  console.log(id);
	// make POST ajax call
	$.ajax({
		type: 'POST',
		url: "{% url 'swecourseapp:postresource' %}",
		data: {
      'content': tinymce.activeEditor.getContent(),
      'id': id,
      'csrfmiddlewaretoken': '{{ csrf_token }}',},
    dataType: 'json',
		success: function (response) {
			location.reload();
		},
		error: function (response) {
			// alert the error if any error occured
			alert(response["responseJSON"]["error"]);
		}
	})
})
  </script>
{% endblock javascript %}
{% endblock %}